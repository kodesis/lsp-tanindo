<!-- Floating Action Button -->
<button id="chatToggle" class="chat-btn">
  ðŸ’¬
</button>

<!-- Chat Window -->
<div id="chatWindow" class="chat-box">
  <div class="chat-header">
    <span>Live Chat</span>
    <button id="closeChat" class="btn-close"></button>
  </div>
  <div class="chat-body">
    <p>ðŸ‘‹ Hello! How can I help you?</p>
    <div id="chatMessages"></div>
  </div>
  <div class="chat-footer">
    <input type="text" id="chatInput" class="form-control" placeholder="Type a message...">
    <button id="sendChat" class="btn btn-primary" style="background-color: #28a745; border-color: #28a745;">Send</button>
  </div>
</div>


<section class="py-5" id="kontak">
  <div class="bg-holder" style=" background-image: url(<?= base_url('template/tanindo/') ?>assets/img/illustrations/footer-bg.png);background-position: center;background-size: cover;"></div>
  <!--/.bg-holder-->

  <div class="container">
    <div class="row justify-content-lg-between min-vh-50">
      <div class="col-12">
        <div class="card bg-success">
          <div class="card-body p-sm-4">
            <div class="row">
              <div class="col-md-5 col-12">
                <h6 class="mb-3 text-1000 fw-semi-bold">
                  Find We On Your Maps!
                </h6>
                <div class="google-map">
                  <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3966.8451983096047!2d106.6410738!3d-6.1514809999999995!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2e69f9001e5c0f79%3A0xe06ccf56cfa8b188!2sLEMBAGA%20SERTIFIKASI%20PROFESI%20TANI%20NELAYAN%20INDONESIA!5e0!3m2!1sid!2sid!4v1720581468562!5m2!1sid!2sid" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
              </div>
              <div class="col-md-4 col-12">
                <h6 class="mb-3 text-1000 fw-semi-bold">
                  Alamat Kami
                </h6>
                <p class="mb-0 text-white">
                  <span class="text-white fs--1 fs-sm-1">Sekretariat Vivo Business Park A31 Unit
                    I,<br />
                    Jl. Pembangunan 3 Karang Anyar,
                    Neglasari, <br />
                    Kota Tangerang, Banten 15121,
                    <br />
                    Telp. 021-5958 5665, 0817 6322 965
                    <br />
                  </span>
                </p>
              </div>
              <div class="col-md-3 col-12">
                <h6 class="mb-3 text-1000 fw-semi-bold">
                  Hubungi kami
                </h6>
                <ul class="list-unstyled mb-md-4 mb-lg-0 text-white">
                  <li class="mb-3">
                    <a href="https://www.facebook.com/people/Lsp-Tanindo/pfbid02W8kwmYVzTURSvvDKcx9w5nFfmAGScgDGmbPCAy9jm8foV2DTSAZJw3spCCmjNR9pl/?mibextid=ZbWKwL" target="_blank"><i class="bi bi-facebook"></i>&nbsp;Lsp Tanindo</a>
                  </li>
                  <li class="mb-3">
                    <a href="https://www.instagram.com/lsp_tanindo/?igsh=MWxia3lwamphc3A3Ng%3D%3D" target="_blank"><i class="bi bi-instagram"></i>&nbsp;@lsp_tanindo</a>

                  </li>
                  <li class="mb-3">
                    <a href="https://www.tiktok.com/@lsp.tanindo?_t=8nW0gaTpVce&_r=1" target="_blank"><i class="bi bi-tiktok"></i>&nbsp;@lsp.tanindo</a>

                  </li>
                  <li class="mb-3">
                    <a href="https://www.youtube.com/@lsptanindo" target="_blank"><i class="bi bi-youtube"></i>&nbsp;LSP Tanindo</a>
                  </li>
                  <li class="mb-3">
                    <a href="https://x.com/LspTanindo?t=IOgV_eo43JORkSGwH9cQKQ&s=09" target="_blank"><i class="bi bi-twitter-x"></i>&nbsp;@LspTanindo</a>

                  </li>
                  <li class="mb-3">
                    <a href="tel:02159585665" target="_blank"><i class="bi bi-phone"></i>&nbsp;Telp : 021-5958 5665</a>

                  </li>
                  <li class="mb-3">
                    <a href="https://wa.me/+628176322965" target="_blank"><i class="bi bi-whatsapp"></i>&nbsp;Whatsap : 0817 6322 965</a>

                  </li>
                  <li class="mb-3">
                    <a href="mailto:admin@lsptanindo.com " target="_blank"><i class="bi bi-envelope"></i>&nbsp;admin@lsptanindo.com</a>

                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <hr class="text-300 mb-0" />
    <div class="row flex-center py-5">
      <div class="col-12 col-sm-8 col-md-6 text-center text-md-start">
        <a class="text-decoration-none" href="#"><img class="d-inline-block align-top img-fluid" src="<?= base_url('template/tanindo/') ?>assets/img/gallery/logo-icon-tanindo.png" alt="" width="40" /><span class="text-theme font-monospace fs-3 ps-2">Tanindo</span></a>
      </div>
      <div class="col-12 col-sm-8 col-md-6">
        <p class="fs--1 text-dark my-2 text-center text-md-end">
          &copy; 2024 LSP Tanindo
          <br />
          This template is made with Love by
          <a class="text-dark" href="https://themewagon.com/" target="_blank">ThemeWagon
          </a>
        </p>
      </div>
    </div>
  </div>
</section>
</main>
<!-- ===============================================-->
<!--    End of Main Content-->
<!-- ===============================================-->

<!-- ===============================================-->
<!--    JavaScripts-->
<!-- ===============================================-->
<script src="<?= base_url('template/tanindo/') ?>vendors/@popperjs/popper.min.js"></script>
<script src="<?= base_url('template/tanindo/') ?>vendors/bootstrap/bootstrap.min.js"></script>
<script src="<?= base_url('template/tanindo/') ?>vendors/is/is.min.js"></script>
<!-- <script src="https://polyfill.io/v3/polyfill.min.js?features=window.scroll"></script> -->
<script src="<?= base_url('template/tanindo/') ?>assets/js/theme.js"></script>
<script>
  function downloadFile() {
    var link = document.createElement("a");
    link.href = "<?= base_url('template/tanindo/') ?>assets/document/compro_lsp_tanindo_2024.pptx";
    link.download = "compro_lsp_tanindo_2024.pptx";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
  }
  let lastMessageCount = 0;
  let newMessageAlert = new Audio("<?= base_url('assets/sounds/notification.mp3') ?>"); // Ensure this file exists

  document.getElementById("chatToggle").addEventListener("click", function() {
    document.getElementById("chatWindow").style.display = "flex";
    document.getElementById("chatToggle").classList.remove("new-message"); // Remove ðŸ”´ alert
    document.title = "Live Chat"; // Reset title
    loadMessages();
  });

  document.getElementById("closeChat").addEventListener("click", function() {
    document.getElementById("chatWindow").style.display = "none";
  });

  document.getElementById("sendChat").addEventListener("click", function() {
    sendMessage();
  });

  document.getElementById("chatInput").addEventListener("keypress", function(event) {
    if (event.key === "Enter") {
      sendMessage();
    }
  });

  function sendMessage() {
    let input = document.getElementById("chatInput");
    let message = input.value.trim();
    if (message !== "") {
      let chatMessages = document.getElementById("chatMessages");

      let newMessage = document.createElement("div");
      newMessage.classList.add("chat-bubble", "guest-message");
      newMessage.innerHTML = `<strong>You:</strong> ${message}`;
      chatMessages.appendChild(newMessage);

      let xhr = new XMLHttpRequest();
      xhr.open("POST", "<?= base_url('chat/send_message') ?>", true);
      xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
      xhr.send("message=" + encodeURIComponent(message));

      input.value = "";
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }
  }

  function loadMessages() {
    let xhr = new XMLHttpRequest();
    xhr.open("GET", "<?= base_url('chat/get_messages') ?>", true);
    xhr.onload = function() {
      if (xhr.status == 200) {
        let messages = JSON.parse(xhr.responseText);
        let chatMessages = document.getElementById("chatMessages");

        if (messages.length > lastMessageCount && messages[messages.length - 1].sender_type === "admin") {
          // if (document.getElementById("chatWindow").style.display === "none") {
          document.getElementById("chatToggle").classList.add("new-message"); // Add ðŸ”´ alert
          newMessageAlert.play(); // Play sound
          flashTitle(); // Flash title
          // }
        }

        chatMessages.innerHTML = "";
        messages.forEach(function(msg) {
          let messageDiv = document.createElement("div");
          messageDiv.classList.add("chat-bubble");

          if (msg.sender_type === "admin") {
            messageDiv.classList.add("admin-message");
            messageDiv.innerHTML = `<strong>Admin:</strong> ${msg.message}`;
          } else {
            messageDiv.classList.add("guest-message");
            messageDiv.innerHTML = `<strong>You:</strong> ${msg.message}`;
          }

          chatMessages.appendChild(messageDiv);
        });

        chatMessages.scrollTop = chatMessages.scrollHeight;
        lastMessageCount = messages.length; // Update message count
      }
    };
    xhr.send();
  }

  // Auto refresh chat every 3 seconds
  setInterval(loadMessages, 3000);

  // Flash Title Notification
  function flashTitle() {
    let isFlashing = true;
    let originalTitle = "Live Chat";
    let newTitle = "ðŸ”´ New Message!";
    let interval = setInterval(() => {
      document.title = isFlashing ? newTitle : originalTitle;
      isFlashing = !isFlashing;
    }, 1000);

    setTimeout(() => {
      clearInterval(interval);
      document.title = originalTitle;
    }, 5000); // Stop flashing after 5 seconds
  }
</script>
</body>

</html>